<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Crypto Watcher</title>

<link rel="stylesheet" href="/style.css">

<script src="/main.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>

<header class="topbar">
  <div class="container topbar-inner">

    <div class="logo">Crypto Watcher</div>

    <nav>
      <a href="/" class="active">Home</a>
      <a href="/search">Search</a>
      <a href="/contact">Contact</a>
      <a href="/admin" id="adminLink">Admin</a>

      <a href="/login" id="loginBtn">Login</a>
      <a href="#" id="logoutBtn">Logout</a>
    </nav>

  </div>
</header>


<section class="hero">
  <h1>Track Crypto Easily</h1>
  <p>Fast. Secure. Smart tracking.</p>
</section>


<main class="container wide-container">

  <!-- TRENDING -->
  <div class="trend-box">
    <h3>ðŸ”¥ Trending Coin</h3>
    <p id="trendName">Loading...</p>
    <canvas id="trendChart" height="100"></canvas>
  </div>


  <h2>Popular Assets</h2>

  <!-- USER FRIENDLY LIST -->
  <div id="assetsGrid" class="assets-list"></div>

</main>


<footer>
Crypto Watcher Â© 2026
</footer>


<script>

let trendChart = null;


// TRENDING

async function loadTrending(){

  const coins = ["bitcoin","ethereum","solana","cardano","ripple"];
  const coin = coins[Math.floor(Math.random()*coins.length)];

  try{

    const priceRes = await fetch(
      `https://api.coingecko.com/api/v3/simple/price?ids=${coin}&vs_currencies=usd`
    );

    const priceData = await priceRes.json();

    const chartRes = await fetch(
      `https://api.coingecko.com/api/v3/coins/${coin}/market_chart?vs_currency=usd&days=7`
    );

    const chartData = await chartRes.json();

    const prices = chartData.prices.map(p=>p[1]);
    const labels = chartData.prices.map(p=>{
      return new Date(p[0]).toLocaleDateString();
    });

    document.getElementById("trendName").innerText =
      coin.toUpperCase()+" â€¢ $"+priceData[coin].usd.toLocaleString();


    if(trendChart){
      trendChart.destroy();
    }

    trendChart = new Chart(trendChartCanvas,{
      type:"line",
      data:{
        labels,
        datasets:[{
          data:prices,
          borderColor:"#9b87ff",
          backgroundColor:"rgba(155,135,255,0.15)",
          fill:true,
          tension:0.3
        }]
      },
      options:{
        plugins:{legend:{display:false}},
        scales:{
          x:{display:false},
          y:{ticks:{color:"#ccc"}}
        }
      }
    });

  }catch{
    document.getElementById("trendName").innerText="API error ðŸ˜¢";
  }
}



// ASSETS LIST

async function loadAssets(){

  const grid = document.getElementById("assetsGrid");

  const res = await fetch("/api/assets");
  const data = await res.json();

  if(!data.length){
    grid.innerHTML="<p>No assets</p>";
    return;
  }

  grid.innerHTML = data.map(a=>`

  <div class="asset-row">

    <img src="${a.imageUrl || 'https://cdn-icons-png.flaticon.com/512/825/825508.png'}">

    <div class="asset-name">
      <strong>${a.name}</strong>
      <span>${a.symbol}</span>
    </div>

    <div class="asset-col">
      <span>Price</span>
      $${Number(a.price).toLocaleString()}
    </div>

    <div class="asset-col">
      <span>Market Cap</span>
      $${Number(a.marketCap || 0).toLocaleString()}
    </div>

    <div class="asset-col">
      <span>24h</span>
      ${a.change24h || "0"}%
    </div>

    <a class="asset-btn" href="/item/${a._id}">View</a>

  </div>

  `).join("");

}


loadTrending();
loadAssets();

setInterval(loadAssets,3000);

</script>

</body>
</html>
