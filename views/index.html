<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crypto Watcher</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body>

<header>
  <div class="nav-container">

    <div class="logo">Crypto Watcher</div>

    <nav>
      <a href="/">Home</a>
      <a href="/admin">Admin</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
      <a href="/search">Search</a>
    </nav>

  </div>
</header>


<section class="hero">
  <h1>Track Crypto Easily</h1>
  <p>Monitor popular cryptocurrencies and explore market data</p>
</section>


<main>

  <h2>Popular Assets</h2>

  <div class="card-grid" id="assetsGrid"></div>


  <h2 style="margin-top:40px;">API Test Links</h2>

  <ul>
    <li><a href="/api/assets" target="_blank">/api/assets</a></li>
    <li><a href="/api/assets?sortBy=priceDesc" target="_blank">/api/assets?sortBy=priceDesc</a></li>
    <li><a href="/api/assets?fields=name,symbol,price" target="_blank">/api/assets?fields=name,symbol,price</a></li>
  </ul>

</main>


<footer>
  Crypto Watcher © 2025
</footer>


<script>

function getDefaultImage(symbol) {

  const map = {
    BTC: "https://images.unsplash.com/photo-1621416894569-0f39ed31d247",
    ETH: "https://img.decrypt.co/insecure/rs:fit:3840:0:0:0/plain/https://cdn.decrypt.co/wp-content/uploads/2024/07/ethereum-coin-wall-street-price-chart-gID_7.jpeg@webp",
    SOL: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ781zFDNh3MT8HWHDnXrDP2KPt6lHyfI-Ysw&s"
  };

  return map[symbol] || map.BTC;
}


async function loadAssets() {

  const grid = document.getElementById("assetsGrid");


  try {

    const res = await fetch("/api/assets");
    const assets = await res.json();


    if (!Array.isArray(assets) || assets.length === 0) {

      grid.innerHTML = `
        <div class="card">
          <h3>No assets found</h3>
          <p>Add assets in Admin panel</p>
          <a href="/admin">Go to Admin</a>
        </div>
      `;

      return;
    }


    grid.innerHTML = assets.map(asset => {

      const symbol = (asset.symbol || "").toUpperCase();

      const img =
        asset.imageUrl && asset.imageUrl.trim() !== ""
          ? asset.imageUrl
          : getDefaultImage(symbol);


      return `
        <div class="card">

          <img src="${img}" alt="${asset.name}">

          <h3>${asset.name}</h3>

          <p style="margin:10px 0;color:#555;">
            ${symbol} • $${Number(asset.price).toLocaleString()}
          </p>

          <a href="/item/${asset._id}">View details</a>

        </div>
      `;

    }).join("");


  } catch (e) {

    grid.innerHTML = `
      <div class="card">
        <h3>Error loading assets</h3>
        <p>Check server + MongoDB connection</p>
      </div>
    `;

  }

}


loadAssets();

</script>

</body>
</html>
